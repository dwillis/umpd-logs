
<!doctype html>
<html lang="en">
    <head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="../static/style.css" />
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.css">
		<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.js"></script>
		<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/plug-ins/1.11.5/dataRender/datetime.js"></script>
		<script type="text/javascript" charset="utf8" src="../static/moment.min.js"></script>
		
		<!--script type="text/javascript" charset="utf8" src="../static/script.js"></script-->
		
		
		
		<!--template syntax is called Jinja; look up filters-->
	</head>
    <body>
		<div id="top-header">
			<div id="header">UMD Police Activity Log with Arrests</div>
		</div>
		<div id="container">
			<div class="byline">
				By Rachel Logan, with updates from Derek Willis. <a href="https://github.com/dwillis/umpd-logs">See the code</a>
			</div>
			<div id="intro">
				Welcome to a tracker for University of Maryland Police Department activity and arrest logs. 
				Data is scraped every morning from the UMPD website using Beautiful Soup in Python and arranged in this Flask app.
				On the UMPD site, data is displayed in flat, separate tables, so this site aims to add search and sort functions, 
				as well as the ability to connect arrests with the associated activity log entry. 
				Try searching for arrest or active dispositions. CBE stands for Cleared By Exception, meaning the case 
				is no longer active but is not resolved.
			</div>
			<div id="stats" class="stat-row" role="region" aria-label="Summary statistics">
				<div class="stat-card">
					<div class="stat-value">{{ total_incidents }}</div>
					<div class="stat-label">Total incidents</div>
				</div>
				<div class="stat-card">
					<div class="stat-value">{{ most_common_type }}</div>
					<div class="stat-label">Most common (all time)</div>
				</div>
				<div class="stat-card">
					<div class="stat-value">{{ most_common_30 }}</div>
					<div class="stat-label">Most common (30 days)</div>
				</div>
			</div>
			<div id="table-stuff">
				<div id= "mainbar">
					<table id="crime-table" data-order='[[ 2, "desc" ]]' border=1 cellpadding=7>
						<thead>
							<tr>
								<th>Case number</th>
								<th>Occurred</th>
								<th>Reported</th>
								<th>Type</th>
								<th>Disposition</th>
								<th>Location</th>
							</tr>
						</thead>
						<tbody>
							{% for obj in activity_list %}
							<tr>
								<td>{{ obj['UMPD Case Number'] }}</td>
								<td>{{ obj['CASE_DATE'] }}</td>
								<td>{{ obj['REPORT_DATE'] }}</td>
								<td>{{ obj['Crime Type'] }}</td>
								<td>
									{% if obj['Disposition'] == 'Arrest' %}
										<a href="#" class="more-link" onclick="clickForMore(this,'{{ obj['UMPD Case Number'] }}');return false;">{{ obj['Disposition'] }}</a>
									{% else %}
										{{ obj['Disposition'] }}
									{% endif %}
								</td>
								<td>{{ obj['LOCATION'] }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div id="sidebar">
					<div id="more-stuff">Click 'More' to see a connected arrest.</div>
				</div>
			</div> 
		</div>
		<footer>
			<div id="footer-text">Copyright 2022-2025</div>
		</footer>
		<script>
			$(document).ready( function () {
				$('#crime-table').DataTable({
					"order": [[2,"desc"]],
					columnDefs: [ {
					    targets: [1,2],
					    render: $.fn.dataTable.render.moment( 'YYYY-MM-DD HH:mm:ss','MMM D, YYYY, h:mma' )
					} ]
				});
				
			} );
		</script>
		<script language="JavaScript">
			function clickForMore(btn,case_number){
			
				var all_arrests = {{ arrest_list|tojson }}
				console.log(case_number)
				console.log(all_arrests)
				
				var arrest = null;
				for (var i = 0; i < all_arrests.length; i++) {
					var obj = all_arrests[i];
					// Defensive: support both 'UMPD Case Number' and 'UMPD CASE NUMBER'
					if ((obj['UMPD Case Number'] || obj['UMPD CASE NUMBER']) == case_number) {
						arrest = obj;
						break;
					}
				}
				console.log(arrest);
				var content = '';
				if (arrest) {
					content = `<h2>Arrest entry:</h2>
						<ul>
							<li>Arrest number: ${ arrest['Arrest Number'] || '' }</li>
							<li>Charge date and time: ${ arrest['Arrested Date Time'] || '' }</li>
							<li>Charge: ${ arrest['Arrested Charge'] || '' }</li>
							<li>Age: ${ arrest['Age'] || '' }</li>
							<li>Race: ${ arrest['Race'] || '' }</li>
							<li>Gender: ${ arrest['Sex'] || '' }</li>
							<li>Description: ${ arrest['DESCRIPTION'] || '' }</li>
						</ul>`;
				} else {
					content = '<h2>No connected arrest found.</h2>';
				}
				
				document.getElementById("more-stuff").innerHTML = content;
				
				for (row of document.getElementsByTagName("tr")){
					row.style.backgroundColor = "white";
				}
				
				btn.parentElement.parentElement.style.backgroundColor = "yellow";
			}
		</script>
    </body>
</html>